# type: ignore
from xonsh.tools import EnvPath
import requests

def alias(name: str):
    def deco(func):
        def wrapper(argv):
            return func(*argv)
        aliases[name] = wrapper
        return func
    return deco

$VIRTUALENV_HOME = str(p"~/Env")
xontrib load zoxide
xontrib load vox
vox activate py312
clear


$PROMPT = "{INTENSE_GREEN}[{cwd}]{RESET}\n"
$PNPM_HOME = "~/Env/pnpm"
$PATH.add("/usr/lib/ccache/bin", front=True)
$PATH.extend([
    "~/Bin",
    "~/Bin/Godot",
    "~/.ghcup/bin",
    "~/.cabal/bin",
    "~/.cargo/bin",
    "~/.elan/bin",
    "~/Code/FOSS/zig",
    "~/Code/FOSS/zls/zig-out/bin",
    "~/Code/FOSS/odin",
    "~/Code/FOSS/ols",
    "~/Code/FOSS/aseprite/build/bin",
    "~/Code/FOSS/slang/bin",
    $PNPM_HOME,
])


INCLUDE_PATH = [
    "/usr/local/share/koka/v3.1.2/kklib/include",
    "~/.ghcup/ghc/9.10.1/lib/ghc-9.10.1/lib/x86_64-linux-ghc-9.10.1/rts-1.0.2/include",
    "/usr/include/python3.12",
    "~/.elan/toolchains/stable/include",
]
$C_INCLUDE_PATH = EnvPath(INCLUDE_PATH)
$CPLUS_INCLUDE_PATH = EnvPath(INCLUDE_PATH)
$LD_LIBRARY_PATH = EnvPath([
    p"/usr/local/lib",
])

$MANPAGER="sh -c 'col -bx | bat -l man -p'"
$MANROFFOPT="-c"

aliases.update({
    "py": "python",
    "cls": "clear",
    "dpi": "ciadpi -i 127.0.0.1 -p 10801 -s1 -q1 -f-1 -S -b661 -As",
    "pixelorama": "~/Bin/Pixelorama/Pixelorama.x86_64",
    "ror": "r2modman --no-sandbox",
    "config": "nvim ~/.xonshrc",
    "fucking": "sudo",
})

@alias("c")
def vscode(path: str = '.'):
    z @(path)
    code -r --password-store=gnome-libsecret . &

@alias("n")
def neovim(path: str = '.'):
    z @(path)
    nvim .

@alias("ls")
def list_files(path: str = ".", level: int = 2):
    exa @(path) --icons --long --all --tree --level @(level)

AOC_SESSION: str = p"~/.aoc_session".read_text().strip()
AOC_HEADERS: dict[str, str] = {"Cookie": f"session={AOC_SESSION}"}
@alias("aoc")
def advent_of_code(year: str, day: str, file_path: str):
    response = requests.get(f"https://adventofcode.com/{year}/day/{day}/input", headers = AOC_HEADERS)
    with open(file_path, "w") as file:
        file.write(response.text)

